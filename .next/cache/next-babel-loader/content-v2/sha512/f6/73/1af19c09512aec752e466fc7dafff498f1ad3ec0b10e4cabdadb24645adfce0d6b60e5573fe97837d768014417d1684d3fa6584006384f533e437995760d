{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nimport { logError } from \"common/helpers/errors\";\nvar requestHost = \"\";\n\nif (true) {\n  requestHost = \"http://localhost:8000\";\n}\n\nexport var request = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2) {\n    var formData, isPrivate, _ref2$options, options, _ref2$toJSON, toJSON, url, headers, _options, token, fd, response;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            formData = _ref2.formData, isPrivate = _ref2.isPrivate, _ref2$options = _ref2.options, options = _ref2$options === void 0 ? {} : _ref2$options, _ref2$toJSON = _ref2.toJSON, toJSON = _ref2$toJSON === void 0 ? true : _ref2$toJSON, url = _ref2.url;\n            headers = {};\n            _options = _objectSpread({}, options);\n\n            if (options.headers) {\n              headers = _objectSpread({}, options.headers);\n            }\n\n            if (!isPrivate) {\n              _context.next = 10;\n              break;\n            }\n\n            token = localStorage.getItem(\"token\");\n\n            if (token) {\n              _context.next = 9;\n              break;\n            }\n\n            console.info(\"---Token not found\");\n            return _context.abrupt(\"return\");\n\n          case 9:\n            headers = _objectSpread(_objectSpread({}, headers), {}, {\n              Authorization: \"Bearer \".concat(token)\n            });\n\n          case 10:\n            fd = new FormData();\n\n            if (formData) {\n              Object.keys(formData).forEach(function (name) {\n                var value = formData[name];\n\n                if (value instanceof FileList) {\n                  _toConsumableArray(value).forEach(function (file) {\n                    fd.append(file.name, file, file.name);\n                  });\n                } else {\n                  fd.append(name, value);\n                }\n              });\n              _options = _objectSpread(_objectSpread({}, _options), {}, {\n                body: fd\n              });\n            }\n\n            _context.prev = 12;\n            _context.next = 15;\n            return fetch(\"\".concat(requestHost).concat(url), _objectSpread(_objectSpread({}, _options), {}, {\n              headers: _objectSpread({}, headers)\n            }));\n\n          case 15:\n            response = _context.sent;\n            _context.next = 18;\n            return handleResponse({\n              response: response,\n              toJSON: toJSON\n            });\n\n          case 18:\n            return _context.abrupt(\"return\", _context.sent);\n\n          case 21:\n            _context.prev = 21;\n            _context.t0 = _context[\"catch\"](12);\n            logError(_context.t0, \"request\");\n\n          case 24:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[12, 21]]);\n  }));\n\n  return function request(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar handleResponse = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref4) {\n    var response, toJSON, status, _yield$response$json, data, errors;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            response = _ref4.response, toJSON = _ref4.toJSON;\n\n            if (!toJSON) {\n              _context2.next = 15;\n              break;\n            }\n\n            _context2.prev = 2;\n            status = response.status;\n            _context2.next = 6;\n            return response.json();\n\n          case 6:\n            _yield$response$json = _context2.sent;\n            data = _yield$response$json.data;\n            errors = _yield$response$json.errors;\n            return _context2.abrupt(\"return\", {\n              data: data,\n              errors: errors,\n              status: status\n            });\n\n          case 12:\n            _context2.prev = 12;\n            _context2.t0 = _context2[\"catch\"](2);\n            logError(_context2.t0, \"handleResponse\");\n\n          case 15:\n            return _context2.abrupt(\"return\", {\n              response: response\n            });\n\n          case 16:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[2, 12]]);\n  }));\n\n  return function handleResponse(_x2) {\n    return _ref3.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["/home/oleg/PhpstormProjects/NextStarterKit/src/app/service/index.js"],"names":["requestHost","request","formData","isPrivate","options","toJSON","url","headers","_options","token","localStorage","console","Authorization","fd","Object","value","file","body","response","fetch","handleResponse","logError","status","data","errors"],"mappings":"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","sourcesContent":["// @flow\nimport { logError } from \"common/helpers/errors\";\n\nlet requestHost = \"\";\n\nif (process.env.NODE_ENV === \"development\") {\n    requestHost = \"http://localhost:8000\";\n}\n\ntype TProps = {\n    formData?: any,\n    isPrivate?: boolean,\n    options?: any,\n    toJSON?: boolean,\n    url: string,\n};\n\nexport const request = async ({\n    formData,\n    isPrivate,\n    options = {},\n    toJSON = true,\n    url,\n}: TProps): any => {\n    let headers = {};\n    let _options = { ...options };\n\n    if (options.headers) {\n        headers = {\n            ...options.headers,\n        };\n    }\n\n    if (isPrivate) {\n        const token = localStorage.getItem(\"token\");\n        if (!token) {\n            console.info(\"---Token not found\");\n            return;\n        }\n        headers = {\n            ...headers,\n            Authorization: `Bearer ${token}`,\n        };\n    }\n    const fd = new FormData();\n\n    if (formData) {\n        Object.keys(formData).forEach((name) => {\n            const value = formData[name];\n            if (value instanceof FileList) {\n                [...value].forEach((file) => {\n                    fd.append(file.name, file, file.name);\n                });\n            } else {\n                fd.append(name, value);\n            }\n        });\n\n        _options = {\n            ..._options,\n            body: fd,\n        };\n    }\n\n    try {\n        const response = await fetch(`${requestHost}${url}`, {\n            ..._options,\n            headers: {\n                ...headers,\n            },\n        });\n        return await handleResponse({ response, toJSON });\n    } catch (error) {\n        logError(error, \"request\");\n    }\n};\n\nconst handleResponse = async ({ response, toJSON }) => {\n    if (toJSON) {\n        try {\n            const { status } = response;\n            const { data, errors } = await response.json();\n            return { data, errors, status };\n        } catch (error) {\n            logError(error, \"handleResponse\");\n        }\n    }\n    return { response };\n};\n"]},"metadata":{},"sourceType":"module"}